Ext.ux.PrinterFriendly.getHtml=function(){return Ext.get(document.getElementsByTagName("html")[0])};Ext.ux.PrinterFriendly.getQueryString=function(){return window.location.href.split("?")[1]};Ext.ux.PrinterFriendly.isPrinting=function(){return(Ext.urlDecode(Ext.ux.PrinterFriendly.getQueryString())._format=="printerfriendly")};Ext.ux.PrinterFriendly.printPreview=function(a){this.printer_window=new Ext.ux.PrinterWindow(a);this.printer_window.show()};Ext.ux.PrinterFriendly.onReady=function(c,b,a){if(!Ext.ux.PrinterFriendly.isPrinting()){Ext.EventManager.onDocumentReady(c,b,a)}};Ext.ux.PrinterFriendly.onPrinting=function(c,b,a){if(Ext.ux.PrinterFriendly.isPrinting()){Ext.util.CSS.removeStyleSheet("hide-body-css");Ext.EventManager.onDocumentReady(c,b,a)}};Ext.namespace("Ext.ux.PrinterFriendly.util.CSS");Ext.ux.PrinterFriendly.util.CSS.addStyleSheet=function(b,a){var d={rel:"stylesheet",type:"text/css",media:"all"};var a=Ext.apply(d,a||{});var c=document.createElement("link");c.setAttribute("rel",a.rel);c.setAttribute("type",a.type);c.setAttribute("media",a.media);c.setAttribute("href",b);document.getElementsByTagName("head")[0].appendChild(c)};Ext.namespace("Ext.ux.grid");Ext.ux.grid.PrinterGridPanel=Ext.extend(Ext.grid.GridPanel,{getView:function(){if(!this.view){this.view=new Ext.ux.grid.PrinterGridView(this.viewConfig)}return this.view}});Ext.ux.grid.PrinterGridView=Ext.extend(Ext.grid.GridView,{init:function(a){var b=this.templates||{};if(!b.master){b.master=new Ext.Template('<table border="0" cellspacing="0" cellpadding="0" class="x-printer-grid3">',"{header}","<tbody>","{body}","</tbody>","</table>")}if(!b.header){b.header=new Ext.Template('<thead><tr class="x-grid3-hd-row">{cells}</tr></thead>')}if(!b.hcell){b.hcell=new Ext.Template('<td class="x-grid3-hd x-grid3-cell {css}x-grid3-td-{id}" style="{style}">',"{value}","</td>")}if(!b.row){b.row=new Ext.Template('<tr class="x-grid3-row">{cells}</tr>')}if(!b.cell){b.cell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} x-grid3-cell-inner {css}" style="{style}" tabIndex="0" {cellAttr}>',"{value}","</td>")}this.templates=b;Ext.ux.grid.PrinterGridView.superclass.init.call(this,a)},initElements:Ext.emptyFn,layout:Ext.emptyFn,refresh:function(a){this.fireEvent("beforerefresh",this);this.grid.stopEditing();this.renderMaster();if(a===true){this.updateHeaders();this.updateHeaderSortState()}this.layout();this.applyEmptyText();this.fireEvent("refresh",this)},renderHeaders:function(){var h=this.cm,f=this.templates;var d=f.hcell;var b=[],g=[],a={};var e=h.getColumnCount();var j=e-1;for(var c=0;c<e;c++){a.id=h.getColumnId(c);a.css=c==0?"x-grid3-cell-first ":(c==j?"x-grid3-cell-last ":"");a.value=h.getColumnHeader(c)||"&nbsp;";a.style=this.getColumnStyle(c,true);b[b.length]=d.apply(a)}return f.header.apply({cells:b.join("")})},renderMaster:function(){var d=this.renderHeaders();var c=this.renderRows();var a=this.templates.body.apply({rows:c});var b=this.templates.master.apply({header:d,body:a});this.mainBody=this.grid.getGridEl();this.mainBody.update(b)},afterRender:Ext.emptyFn,afterRenderUI:function(){this.renderMaster()},getColumnStyle:function(a,c){var b=!c?(this.cm.config[a].css||""):"";if(this.cm.isHidden(a)){b+="display:none;"}var d=this.cm.config[a].align;if(d){b+="text-align:"+d+";"}return b},scrollToTop:Ext.emptyFn,updateSortIcon:function(b,a){},updateAllColumnWidths:Ext.emptyFn,updateColumnWidth:function(a,b){},updateColumnHidden:function(a,b){}});Ext.ux.grid.PrinterGroupingView=Ext.extend(Ext.ux.grid.PrinterGridView,{initTemplates:function(){Ext.ux.grid.PrinterGroupingView.superclass.initTemplates.call(this);if(!this.startGroup){this.startGroup=new Ext.XTemplate('<tr id="{groupId}" class="x-grid-group {cls}">','<td colspan="',this.grid.colModel.getColumnCount(true),'"><div id="{groupId}-hd" class="x-grid-group-hd" style="{style}"><div>',this.groupTextTpl,"</div></div></td>")}this.startGroup.compile();this.endGroup=""},getGroup:Ext.grid.GroupingView.prototype.getGroup,getGroupField:Ext.grid.GroupingView.prototype.getGroupField,doGroupStart:Ext.grid.GroupingView.prototype.doGroupStart,doGroupEnd:Ext.grid.GroupingView.prototype.doGroupEnd,renderRows:function(){var a=this.getGroupField();var d=!!a;if(this.hideGroupedColumn){var b=this.cm.findColumnIndex(a);if(!d&&this.lastGroupField!==undefined){this.mainBody.update("");this.cm.setHidden(this.cm.findColumnIndex(this.lastGroupField),false);delete this.lastGroupField}else{if(d&&this.lastGroupField===undefined){this.lastGroupField=a;this.cm.setHidden(b,true)}else{if(d&&this.lastGroupField!==undefined&&a!==this.lastGroupField){this.mainBody.update("");var c=this.cm.findColumnIndex(this.lastGroupField);this.cm.setHidden(c,false);this.lastGroupField=a;this.cm.setHidden(b,true)}}}}return Ext.ux.grid.PrinterGroupingView.superclass.renderRows.apply(this,arguments)},doRender:function(d,h,s,a,q,u){if(h.length<1){return""}var B=this.getGroupField();var p=this.cm.findColumnIndex(B);this.enableGrouping=!!B;if(!this.enableGrouping||this.isUpdating){return Ext.grid.GroupingView.superclass.doRender.apply(this,arguments)}var j="width :100%;";var t=this.grid.getGridEl().id;var f=this.cm.config[p];var b=f.groupRenderer||f.renderer;var v=this.showGroupName?(f.groupName||f.header)+": ":"";var A=[],m,w,x,o;for(w=0,x=h.length;w<x;w++){var l=a+w;var n=h[w],e=n.data[B],y=this.getGroup(e,n,b,l,p,s);if(!m||m.group!=y){o=t+"-gp-"+B+"-"+Ext.util.Format.htmlEncode(y);var c=this.state&&typeof this.state[o]!=="undefined"?!this.state[o]:this.startCollapsed;var k=c?"x-grid-group-collapsed":"";m={group:y,gvalue:e,text:v+y,groupId:o,startRow:l,rs:[n],cls:k,style:j};A.push(m)}else{m.rs.push(n)}n._groupId=o}var z=[];for(w=0,x=A.length;w<x;w++){var y=A[w];this.doGroupStart(z,y,d,s,q);z[z.length]=Ext.grid.GroupingView.superclass.doRender.call(this,d,y.rs,s,y.startRow,q,u);this.doGroupEnd(z,y,d,s,q)}return z.join("")},});Ext.ux.PrinterWindow=Ext.extend(Ext.Window,{plain:true,modal:true,maximizable:true,initComponent:function(){this.id="printer-window";this.width=this.width||800;this.height=this.height||600;this.title=this.title||"Print Preview";this.closeText=this.closeText||"Close";this.printText=this.printText||"Print";this.html={id:"printer-iframe",name:"printer-iframe",tag:"iframe",src:this.iframeSrc(),width:"100%",height:"100%",frameborder:"0"};this.buttons=[{text:this.closeText,handler:this.close,scope:this},{text:this.printText,handler:this.print,scope:this}];Ext.ux.PrinterWindow.superclass.initComponent.call(this)},show:function(c,a,b){Ext.ux.PrinterWindow.superclass.show.call(this,c,a,b);this.maximize();this.tools.restore.hide()},print:function(){var a=this.getIframeWindow();if(Ext.isIE){a.focus()}a.print()},getIframe:function(){return Ext.get("printer-iframe")},getIframeWindow:function(){return this.getIframe().dom.contentWindow},iframeSrc:function(){var a=window.location.href.split("#")[0];return a+(a.match(/\?/)?"&":"?")+"_format=printerfriendly"}});if(Ext.ux.PrinterFriendly.ENABLE_SHORTCUTS){Ext.onReady=Ext.ux.PrinterFriendly.onReady;Ext.onPrinting=Ext.ux.PrinterFriendly.onPrinting;Ext.isPrinting=Ext.ux.PrinterFriendly.isPrinting;Ext.printPreview=Ext.ux.PrinterFriendly.printPreview;Ext.addStyleSheet=Ext.ux.PrinterFriendly.util.CSS.addStyleSheet}if(Ext.ux.PrinterFriendly.isPrinting()){Ext.ux.PrinterFriendly.util.CSS.addStyleSheet(Ext.ux.PrinterFriendly.ROOT+"/resources/css/printer-friendly.css");Ext.util.CSS.createStyleSheet("body { display: none }","hide-body-css")};